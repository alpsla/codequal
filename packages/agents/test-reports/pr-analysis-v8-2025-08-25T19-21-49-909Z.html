<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>CodeQual PR Analysis Report</title>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;
            line-height: 1.6;
            color: #24292e;
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
            background: #ffffff;
        }
        h1 { border-bottom: 2px solid #e1e4e8; padding-bottom: 0.3em; }
        h2 { border-bottom: 1px solid #e1e4e8; padding-bottom: 0.3em; margin-top: 24px; }
        h3 { margin-top: 24px; }
        h4 { margin-top: 16px; color: #24292e; }
        table { border-collapse: collapse; width: 100%; margin: 16px 0; }
        th, td { border: 1px solid #e1e4e8; padding: 8px 12px; text-align: left; }
        th { background: #f6f8fa; font-weight: 600; }
        tr:nth-child(even) { background: #f6f8fa; }
        code { background: #f6f8fa; padding: 2px 4px; border-radius: 3px; font-family: monospace; }
        pre { background: #f6f8fa; padding: 16px; border-radius: 6px; overflow-x: auto; }
        pre code { background: none; padding: 0; }
        blockquote { border-left: 4px solid #0366d6; margin: 0; padding-left: 16px; color: #6a737d; }
        hr { border: none; border-top: 1px solid #e1e4e8; margin: 24px 0; }
        strong { font-weight: 600; }
        ul, ol { padding-left: 2em; }
        li { margin: 4px 0; }
        .severity-critical { color: #d73a49; }
        .severity-high { color: #fb8500; }
        .severity-medium { color: #f9c74f; }
        .severity-low { color: #43aa8b; }
    </style>
</head>
<body>
    <div id="content"></div>
    <script>
        const markdown = "# CodeQual PR Analysis Report\n\n## 📊 Executive Summary\n\n**Repository:** https://github.com/sindresorhus/ky  \n**PR Number:** #700  \n**Analysis Date:** 2025-08-25\n\n### Overall Statistics\n\n| Branch | Total Issues | Critical | High | Medium | Low |\n|--------|-------------|----------|------|--------|-----|\n| Main Branch | 24 | 4 | 6 | 12 | 2 |\n| PR Branch | 17 | 3 | 3 | 9 | 2 |\n\n### PR Impact Analysis\n\n| Metric | Count | Description |\n|--------|-------|-------------|\n| 🆕 **New Issues** | 16 | Issues introduced by this PR |\n| ✅ **Fixed Issues** | 23 | Issues resolved by this PR |\n| ➖ **Unchanged Issues** | 1 | Pre-existing issues not addressed |\n| 📈 **Net Impact** | -7 | Overall change in issue count |\n\n### Quality Score\n\n**PR Quality Score:** 0/100\n\n🔴 **Poor** - This PR introduces significant quality issues\n\n---\n\n## 🆕 New Issues Introduced (16)\n\nThese issues were not present in the main branch and have been introduced by this PR:\n\n\n#### 1. Hardcoded Dependency Version vulnerability\n\n- **Severity:** HIGH\n- **Category:** security\n- **Type:** Hardcoded Dependency Version\n- **Location:** `package.json:3`\n\n**Description:**\nUsing hardcoded dependency versions can lead to security vulnerabilities and compatibility issues as libraries evolve.\n\n**Impact:**\nIncreases maintenance burden and exposure to vulnerabilities in outdated libraries\n\n**Recommendation:**\nUse a version range to allow for minor updates and security patches\n\n**Code:**\n```javascript\n\t\"version\": \"1.9.0\",\n```\n\n\n---\n\n#### 2. Deprecated Package Usage\n\n- **Severity:** MEDIUM\n- **Category:** code-quality\n- **Type:** Deprecated Package Usage\n- **Location:** `package.json:15`\n\n**Description:**\nUsing deprecated packages can lead to issues when they are removed or no longer maintained.\n\n**Impact:**\nImpacts the stability of the application\n\n**Recommendation:**\nCheck for alternative packages or updated versions\n\n**Code:**\n```javascript\n\"@types/express\": \"^4.17.17\",\n```\n\n\n---\n\n#### 3. Unused Dependencies\n\n- **Severity:** CRITICAL\n- **Category:** code-quality\n- **Type:** Unused Dependencies\n- **Location:** `package.json:56`\n\n**Description:**\nUnused dependencies increase the size of the project and may introduce security vulnerabilities.\n\n**Impact:**\nIncreases project size and potential security risk\n\n**Recommendation:**\nRemove unused dependencies\n\n**Code:**\n```javascript\n\t\"devDependencies\": {\n```\n\n\n---\n\n#### 4. Hardcoded Dependency Version\n\n- **Severity:** CRITICAL\n- **Category:** code-quality\n- **Type:** Hardcoded Dependency Version\n- **Location:** `package.json:3`\n\n**Description:**\nUsing hardcoded dependency versions can lead to security vulnerabilities and compatibility issues as libraries evolve.\n\n**Impact:**\nLow test coverage can lead to undetected bugs and regressions, especially in critical areas of the application, affecting overall reliability.\n\n**Recommendation:**\nIncrease test coverage by adding unit tests for critical functions and components: // Example: Add tests for key API endpoints and business logic.\n\n**Code:**\n```javascript\n\t\"version\": \"1.9.0\",\n```\n\n\n---\n\n#### 5. Outdated: @types/express@4.17.17\n\n- **Severity:** LOW\n- **Category:** dependencies\n- **Type:** outdated\n- **Location:** `Unknown location`\n\n**Description:**\n1 versions behind\n\n**Recommendation:**\nUpdate to 4.17.18\n\n\n---\n\n#### 6. Potential Memory Leak in Request Handling\n\n- **Severity:** MEDIUM\n- **Category:** code-quality\n- **Type:** Potential Memory Leak in Request Handling\n- **Location:** `test/browser.ts:51`\n\n**Description:**\nIf the server holds references to request objects without releasing them, it can lead to memory leaks.\n\n**Code:**\n```javascript\n\tserver.get('/', (_request, response) => {\n```\n\n\n---\n\n#### 7. Deep Nesting in Request Handling Logic\n\n- **Severity:** LOW\n- **Category:** code-quality\n- **Type:** Deep Nesting in Request Handling Logic\n- **Location:** `test/browser.ts:75`\n\n**Description:**\nDeeply nested code can make the logic hard to follow and maintain, increasing the risk of bugs.\n\n**Code:**\n```javascript\n\tt.deepEqual(results, ['rainbow', 'rainbow', 'rainbow', 'rainbow']);\n```\n\n\n---\n\n#### 8. Missing Test Cases for Error Handling\n\n- **Severity:** HIGH\n- **Category:** code-quality\n- **Type:** Missing Test Cases for Error Handling\n- **Location:** `test/main.ts:2`\n\n**Description:**\nWithout testing error handling paths, the application may not behave as expected under failure conditions.\n\n**Code:**\n```javascript\nimport test from 'ava';\n```\n\n\n---\n\n#### 9. Lack of Timeout Handling in Requests\n\n- **Severity:** MEDIUM\n- **Category:** code-quality\n- **Type:** Lack of Timeout Handling in Requests\n- **Location:** `test/main.ts:5`\n\n**Description:**\nNot implementing timeout handling can cause requests to hang indefinitely.\n\n**Code:**\n```javascript\nimport ky, {TimeoutError} from '../source/index.js';\n```\n\n\n---\n\n#### 10. Inefficient Use of Promises in File Handling\n\n- **Severity:** MEDIUM\n- **Category:** code-quality\n- **Type:** Inefficient Use of Promises in File Handling\n- **Location:** `test/browser.ts:21`\n\n**Description:**\nUsing promises inefficiently can lead to performance bottlenecks.\n\n**Code:**\n```javascript\n\tserver.use('/distribution', express.static(DIST_DIR.replace(/^file:\\/\\//, '')));\n```\n\n\n---\n\n#### 11. Uncaught Exceptions in Asynchronous Code\n\n- **Severity:** MEDIUM\n- **Category:** code-quality\n- **Type:** Uncaught Exceptions in Asynchronous Code\n- **Location:** `test/browser.ts:137`\n\n**Description:**\nUncaught exceptions can lead to application crashes and unpredictable behavior.\n\n**Code:**\n```javascript\ndefaultBrowsersTest('should not copy response body with 204 status code when using `onDownloadProgress` ', async (t: ExecutionContext, page: Page) => {\n```\n\n\n---\n\n#### 12. Low Test Coverage in Critical Areas\n\n- **Severity:** CRITICAL\n- **Category:** code-quality\n- **Type:** Low Test Coverage in Critical Areas\n- **Location:** `test/main.ts:2`\n\n**Description:**\nLow test coverage can lead to undetected bugs and regressions, especially in critical areas of the application.\n\n**Code:**\n```javascript\nimport test from 'ava';\n```\n\n\n---\n\n#### 13. Scope Error\n\n- **Severity:** HIGH\n- **Category:** code-quality\n- **Type:** Scope Error\n- **Location:** `package.json:3`\n\n**Description:**\nError with OpenRouter API: cannot access free variable 'e_client' where it is not associated with a value in enclosing scope\n\n**Impact:**\nPotential unauthorized access or malfunction due to scope access issues\n\n**Recommendation:**\nEnsure that all variables are properly scoped and accessible where needed\n\n**Code:**\n```javascript\n\t\"version\": \"1.9.0\",\n```\n\n\n---\n\n#### 14. Configuration Issue vulnerability\n\n- **Severity:** MEDIUM\n- **Category:** security\n- **Type:** Configuration Issue\n- **Location:** `Unknown location`\n\n**Description:**\nMissing environment variable OPENROUTER_API_KEY\n\n**Impact:**\nAPI may not function properly without a valid API key\n\n**Recommendation:**\nEnsure the OPENROUTER_API_KEY environment variable is set with a valid API key\n\n\n---\n\n#### 15. Configuration Issue\n\n- **Severity:** MEDIUM\n- **Category:** performance\n- **Type:** Configuration Issue\n- **Location:** `Environment Variables:unknown`\n\n**Description:**\nCurrent: undefined, Expected: undefined\n\n**Impact:**\nMissing OPENROUTER_API_KEY environment variable\n\n**Recommendation:**\nSet the OPENROUTER_API_KEY environment variable with a valid API key\n\n\n---\n\n#### 16. Environment Variable Missing\n\n- **Severity:** MEDIUM\n- **Category:** code-quality\n- **Type:** Environment Variable Missing\n- **Location:** `test/browser.ts:51`\n\n**Description:**\nMissing OPENROUTER_API_KEY environment variable or it is not set with a valid API key\n\n**Code:**\n```javascript\n\tserver.get('/', (_request, response) => {\n```\n\n\n\n---\n\n## ✅ Fixed Issues (23)\n\nThese issues were present in the main branch and have been resolved by this PR:\n\n\n#### 1. XSS vulnerability\n\n- **Severity:** CRITICAL\n- **Category:** security\n- **Type:** XSS\n- **Location:** `test/browser.ts:67`\n\n**Description:**\nImproper handling of user-generated content can lead to Cross-Site Scripting (XSS) attacks.\n\n**Impact:**\nAttackers could inject malicious scripts, compromising user data and application integrity.\n\n**Recommendation:**\nSanitize user input before rendering\n\n**Code:**\n```javascript\nresponse.writeHead(200);\nresponse.end(userInput); // Unsafe output\n```\n\n\n---\n\n#### 2. Hardcoded Secrets vulnerability\n\n- **Severity:** HIGH\n- **Category:** security\n- **Type:** Hardcoded Secrets\n- **Location:** `source/config.ts:12`\n\n**Description:**\nHardcoded secrets such as API keys can lead to unauthorized access and data breaches.\n\n**Impact:**\nIf exposed, they can be exploited by malicious users, leading to significant security risks.\n\n**Recommendation:**\nUse environment variables to manage sensitive data\n\n**Code:**\n```javascript\nconst apiKey = '12345-ABCDE'; // Hardcoded API key\n```\n\n\n---\n\n#### 3. Missing Error Handling\n\n- **Severity:** HIGH\n- **Category:** code-quality\n- **Type:** Missing Error Handling\n- **Location:** `source/index.ts:53`\n\n**Description:**\nMissing error handling in HTTP requests\n\n**Impact:**\nCritical functions without tests can lead to undetected bugs and regressions, affecting application stability.\n\n**Recommendation:**\nAdd unit tests for the processPayment function to ensure its reliability and correctness.\n\n**Code:**\n```javascript\n\tBeforeErrorHook,\n```\n\n\n---\n\n#### 4. N+1 Query\n\n- **Severity:** HIGH\n- **Category:** performance\n- **Type:** N+1 Query\n- **Location:** `source/repository.ts:32`\n\n**Description:**\nCurrent: Significant impact on performance due to excessive database queries, Expected: Reduced database load and faster response times\n\n**Impact:**\nExcessive database queries significantly impacting performance.\n\n**Recommendation:**\nOptimize the query by fetching all posts in a single query:\nconst posts = await getPostsByUsers(users.map(user => user.id));\n\n\n---\n\n#### 5. Outdated: express@4.18.2\n\n- **Severity:** LOW\n- **Category:** dependencies\n- **Type:** outdated\n- **Location:** `Unknown location`\n\n**Description:**\n1 versions behind\n\n**Recommendation:**\nUpdate to 4.18.3\n\n\n---\n\n#### 6. Potential XSS Vulnerability\n\n- **Severity:** CRITICAL\n- **Category:** code-quality\n- **Type:** Potential XSS Vulnerability\n- **Location:** `test/browser.ts`\n\n**Description:**\nPotential XSS vulnerability in response handling\n\n\n---\n\n#### 7. Hardcoded Secrets\n\n- **Severity:** MEDIUM\n- **Category:** code-quality\n- **Type:** Hardcoded Secrets\n- **Location:** `source/config.ts`\n\n**Description:**\nHardcoded secrets found in code\n\n\n---\n\n#### 8. N+1 Query Problem\n\n- **Severity:** MEDIUM\n- **Category:** code-quality\n- **Type:** N+1 Query Problem\n- **Location:** `source/repository.ts`\n\n**Description:**\nUnoptimized loop causing N+1 query problem\n\n\n---\n\n#### 9. Memory Leak\n\n- **Severity:** MEDIUM\n- **Category:** code-quality\n- **Type:** Memory Leak\n- **Location:** `source/eventHandler.ts`\n\n**Description:**\nMemory leak due to unreleased event listeners\n\n\n---\n\n#### 10. Missing Unit Tests\n\n- **Severity:** CRITICAL\n- **Category:** code-quality\n- **Type:** Missing Unit Tests\n- **Location:** `source/utils.ts`\n\n**Description:**\nMissing unit tests for critical functions\n\n\n---\n\n#### 11. Uncaught Promise Rejections\n\n- **Severity:** MEDIUM\n- **Category:** code-quality\n- **Type:** Uncaught Promise Rejections\n- **Location:** `source/asyncHandler.ts`\n\n**Description:**\nUncaught promise rejections in async functions\n\n\n---\n\n#### 12. High complexity in undefined\n\n- **Severity:** LOW\n- **Category:** code-quality\n- **Type:** complexity\n- **Location:** `source/sort.ts`\n\n**Description:**\nComplexity: undefined\n\n**Recommendation:**\nRefactor to reduce complexity\n\n\n---\n\n#### 13. Missing Error Handling for HTTP Request Failures\n\n- **Severity:** HIGH\n- **Category:** code-quality\n- **Type:** issue\n- **Location:** `source/core/Ky.ts:77`\n\n**Description:**\nNo description provided\n\n**Code:**\n```javascript\n\t\t\t\t\tthrow new Error('Streams are not supported in your environment. `ReadableStream` is missing.');\n```\n\n\n---\n\n#### 14. Inefficient Loop in Retry Logic\n\n- **Severity:** MEDIUM\n- **Category:** performance\n- **Type:** issue\n- **Location:** `test/retry.ts:7`\n\n**Description:**\nNo description provided\n\n**Code:**\n```javascript\nconst defaultRetryCount = 2;\n```\n\n\n---\n\n#### 15. Lack of Input Validation for URL Parameters\n\n- **Severity:** CRITICAL\n- **Category:** security\n- **Type:** issue\n- **Location:** `source/core/Ky.ts:4`\n\n**Description:**\nNo description provided\n\n**Code:**\n```javascript\n\tInput,\n```\n\n\n---\n\n#### 16. Hardcoded URLs in Tests\n\n- **Severity:** MEDIUM\n- **Category:** testing\n- **Type:** issue\n- **Location:** `test/browser.ts:7`\n\n**Description:**\nNo description provided\n\n**Code:**\n```javascript\nimport {createHttpTestServer, type ExtendedHttpTestServer, type HttpServerOptions} from './helpers/create-http-test-server.js';\n```\n\n\n---\n\n#### 17. Missing Type Annotations for Parameters\n\n- **Severity:** MEDIUM\n- **Category:** code-quality\n- **Type:** issue\n- **Location:** `source/core/Ky.ts:77`\n\n**Description:**\nNo description provided\n\n**Code:**\n```javascript\n\t\t\t\t\tthrow new Error('Streams are not supported in your environment. `ReadableStream` is missing.');\n```\n\n\n---\n\n#### 18. Potential Memory Leak with Event Listeners\n\n- **Severity:** HIGH\n- **Category:** performance\n- **Type:** issue\n- **Location:** `test/browser.ts:156`\n\n**Description:**\nNo description provided\n\n**Code:**\n```javascript\n\t\t\tonDownloadProgress(progressEvent) {\n```\n\n\n---\n\n#### 19. Uncaught Promise Rejections in Asynchronous Tests\n\n- **Severity:** MEDIUM\n- **Category:** testing\n- **Type:** issue\n- **Location:** `test/retry.ts:3`\n\n**Description:**\nNo description provided\n\n**Code:**\n```javascript\nimport {createHttpTestServer} from './helpers/create-http-test-server.js';\n```\n\n\n---\n\n#### 20. Use of Deprecated APIs\n\n- **Severity:** HIGH\n- **Category:** dependencies\n- **Type:** issue\n- **Location:** `source/core/Ky.ts:5`\n\n**Description:**\nNo description provided\n\n**Code:**\n```javascript\nimport { deprecatedFunction } from 'legacy-library';\n```\n\n\n---\n\n#### 21. Insufficient Test Coverage for Edge Cases\n\n- **Severity:** MEDIUM\n- **Category:** testing\n- **Type:** issue\n- **Location:** `test/hooks.ts:1`\n\n**Description:**\nNo description provided\n\n**Code:**\n```javascript\nimport test from 'ava';\n```\n\n\n---\n\n#### 22. Inconsistent Error Messages in API Responses\n\n- **Severity:** MEDIUM\n- **Category:** code-quality\n- **Type:** issue\n- **Location:** `source/core/Ky.ts:1`\n\n**Description:**\nNo description provided\n\n**Code:**\n```javascript\nimport {HTTPError} from '../errors/HTTPError.js';\n```\n\n\n---\n\n#### 23. Missing JSDoc Comments for Public Methods\n\n- **Severity:** MEDIUM\n- **Category:** documentation\n- **Type:** issue\n- **Location:** `source/core/Ky.ts:77`\n\n**Description:**\nNo description provided\n\n**Code:**\n```javascript\n\t\t\t\t\tthrow new Error('Streams are not supported in your environment. `ReadableStream` is missing.');\n```\n\n\n\n---\n\n## ➖ Unchanged Issues (1)\n\nThese pre-existing issues remain unaddressed:\n\n\n#### 1. Low test coverage: 67.5%\n\n- **Severity:** MEDIUM\n- **Category:** code-quality\n- **Type:** testing\n- **Location:** `Unknown location`\n\n**Description:**\nIncrease test coverage to at least 80%\n\n\n\n---\n\n## 📋 Recommendations\n\n### Immediate Actions Required\n\n⚠️ **Critical Issues:** This PR introduces 3 critical issue(s) that must be fixed before merging.\n  \n- Fix Unused Dependencies in `package.json`\n- Fix Hardcoded Dependency Version in `package.json`\n- Fix Low Test Coverage in Critical Areas in `test/main.ts`\n\n\n🟠 **High Priority Issues:** 3 high severity issue(s) should be addressed.\n  \n- Address Hardcoded Dependency Version vulnerability in `package.json`\n- Address Missing Test Cases for Error Handling in `test/main.ts`\n- Address Scope Error in `package.json`\n\n\n### Merge Decision\n\n❌ **DECLINE** - Critical issues must be resolved before merging\n\n---\n\n## 📊 Detailed Metrics\n\n### Issues by Category\n\n| Category | Main Branch | PR Branch | Change |\n|----------|-------------|-----------|--------|\n| security | 3 | 2 | -1 📉 |\n| code-quality | 12 | 13 | +1 📈 |\n| performance | 3 | 1 | -2 📉 |\n| dependencies | 2 | 1 | -1 📉 |\n| testing | 3 | 0 | -3 📉 |\n| documentation | 1 | 0 | -1 📉 |\n\n### Performance Impact\n\n- **Analysis Duration:** 249.4s\n- **Tokens Used:** 0\n- **Estimated Cost:** $0.0000\n\n---\n\n*Generated by CodeQual Analysis v8 - 2025-08-25T19:21:49.909Z*\n";
        document.getElementById('content').innerHTML = marked.parse(markdown);
    </script>
</body>
</html>